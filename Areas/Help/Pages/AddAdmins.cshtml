@page
@model woodgrovedemo.Help.Pages.AddAdminsModel
@{
    ViewData["Title"] = "Add an admin account";
    Layout = "_Layout";
}



<h1 style="margin-top: 25px; margin-bottom: 25px;">Add an admin account</h1>

<p>
    In Microsoft Entra External ID, a customer tenant represents your directory of consumer and guest accounts.
    With an administrator role, work and guest accounts can <a
        href="https://learn.microsoft.com/entra/external-id/customers/quickstart-tenant-setup" target="_blank"
        class="link-dark link-offset-2">manage the tenant</a>.
</p>

@await Html.PartialAsync("_HelpSelector.cshtml", 3)

<div class="tab-content wg-tab-content">
    <div class="tab-pane active" id="microsoftEntraAdminCenter" role="tabpanel"
        aria-labelledby="microsoftEntraAdminCenter-tab" tabindex="0">
        @await Html.PartialAsync("_StepsButtons.cshtml")

        <div class="bs-stepper vertical" id="Stepper">
            @await Html.PartialAsync("_Steps.cshtml", 6)

            <div class="bs-stepper-content">
                <div id="step-1" role="tabpanel" class="bs-stepper-pane fade" aria-labelledby="steppertrigger1">

                    <h4>Prerequisites</h4>
                    Before you start make sure you have configured the following:
                    <ol>
                        <li><a href="CreateTenant">Create a tenant</a></li>

                    </ol>

                    <p>
                        To add an admin account, sign in to the <a href="https://entra.microsoft.com/" target="_blank"
                            class="link-dark link-offset-2">Microsoft Entra admin center</a> with
                        Global Administrator or Privileged Role Administrator permissions and browse to <b>Identity </b>
                        >
                        <b> Users </b> > <b>All users</b>. Then, select <b>New user</b> > <b>Create new user</b>.
                    </p>

                    <a href="#" class="pop" onclick="return false;">
                        <img class="img-fluid border" src="~/Help/AddAdmins/Select-users.png">
                    </a>
                </div>

                <div id="step-2" role="tabpanel" class="bs-stepper-pane fade" aria-labelledby="steppertrigger2">
                    <p>
                        On the <b>Create new user</b> page, under <b>basics</b>, enter information for this admin:

                        <b>User principal name</b> (Required). The user name of the new user. For example,
                        emily@woodgrovelive.com.
                        Eneter a <b>Name</b>.

                        Copy the autogenerated password provided in the <b>Password box</b>. You'll need to give this
                        password to
                        the admin to sign in for the first time.
                    </p>

                    <a href="#" class="pop" onclick="return false;">
                        <img class="img-fluid border" src="~/Help/AddAdmins/User-type-and-name.png">
                    </a>
                </div>

                <div id="step-3" role="tabpanel" class="bs-stepper-pane fade" aria-labelledby="steppertrigger3">
                    <p>
                        Under <b>Properties</b>, you can also enter a <b>First name</b> and <b>Last name</b> along with
                        some
                        other properties.
                    </p>

                    <a href="#" class="pop" onclick="return false;">
                        <img class="img-fluid border" src="~/Help/AddAdmins/Properties.png">
                    </a>
                </div>

                <div id="step-4" role="tabpanel" class="bs-stepper-pane fade" aria-labelledby="steppertrigger4">
                    <p>
                        To add administrative permissions for the user, add them to a Microsoft Entra role. You can
                        assign the user to be a <b>Global Administrator</b> or one or more of the limited administrator
                        roles in
                        Microsoft Entra ID. Under <b>Assignments</b>, and select <b>Add role</b>.
                        Then, find the role you want to add, and choose <b>Select</b>.
                    </p>

                    <a href="#" class="pop" onclick="return false;">
                        <img class="img-fluid border" src="~/Help/AddAdmins/Select-role.png">
                    </a>

                </div>

                <div id="step-5" role="tabpanel" class="bs-stepper-pane fade" aria-labelledby="steppertrigger5">
                    <p>
                        To create the account, select <b>Create</b>.
                    </p>

                    <a href="#" class="pop" onclick="return false;">
                        <img class="img-fluid border" src="~/Help/AddAdmins/Create.png">
                    </a>

                </div>

                <div id="step-6" role="tabpanel" class="bs-stepper-pane fade" aria-labelledby="steppertrigger6">
                    <div class="alert alert-success" role="alert">
                        <h4 class="alert-heading">Well done!</h4>
                        <p> The admin is created and added to your customer tenant. It's preferable to have at least one
                            admin account native to your customer tenant assigned the Global Administrator role. This
                            account can be considered a break-glass account or emergency access account.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="tab-pane" id="microsoftGraph" role="tabpanel" aria-labelledby="microsoftGraph-tab" tabindex="0">
        <h4 class="graph-header">Dependencies</h4>
        This script is self-contained.

        <h4 class="graph-header graph-header-space">1. Create a user</h4>
        <div>
            To <a href="https://learn.microsoft.com/graph/api/user-post-users" target="_blank"
                class="link-dark link-offset-2">create a user</a>, use the following Microsoft
            Graph and replace:
            <ul>
                <li><b>{DisplayName}</b> with the user display name.</li>
                <li><b>{MailNickname}</b> with a mail alias for the user. This property must be specified when a user is
                    created.</li>
                <li><b>{UserPrincipalName}</b> with the principal name (UPN) of the user. The general format is
                    alias@domain,
                    where the domain must be present in the tenant's collection of verified domains. </li>
                <li><b>{Password}</b> with a temporary password that you will share with the user. During the first
                    sign-in,
                    the user will be asked to change their password.</li>
            </ul>
        </div>

        <!-- HTTP method-->
        <div class="function-http">
            <code><span class="method">POST</span> https://graph.microsoft.com/v1.0/users</code>
        </div>

        <!-- PowerShell method-->
        <div class="function-powershell">
            <code><span class="method">Connect-MgGraph</span> <span class="param">-Scopes</span> "User.ReadWrite.All"</code>
        </div>

        <!-- Code-->
        <a type="button" class="link-opacity-75 copyToClipboard" href="#"><i class="bi bi-copy"></i></a>
        <pre class="replace" style="margin-top: 10px;">
{
    "accountEnabled": true,
    "displayName": "<span class="highlight">{DisplayName}</span>",
    "mailNickname": "<span class="highlight">{MailNickname}</span>",
    "userPrincipalName": "<span class="highlight">{UserPrincipalName}</span>",
    "passwordProfile": {
        "forceChangePasswordNextSignIn": true,
        "password": "<span class="highlight">{Password}</span>"
    }
}
</pre><br>

        <!-- PowerShell method-->
        <div class="function-powershell">
            <code><span class="method">New-MgBetaUser</span> <span class="param">-BodyParameter</span> $params</code><br>&nbsp;<br><br>
        </div>

        <!-- Create user example-->
        <a class="btn btn-success btn-sm" data-bs-toggle="collapse"
            href="#collapseCreateExample" role="button" aria-expanded="false" aria-controls="collapseCreateExample">
            Show example
        </a><br>
        <div class="collapse example" id="collapseCreateExample">
            The following example shows how to create a new user account for Adele Vance.
            <br>
            <div class="function-http">
                <code><span class="method">POST</span> https://graph.microsoft.com/v1.0/users</code>
            </div>

            <a type="button" class="link-opacity-75 copyToClipboard" href="#"><i class="bi bi-copy"></i></a>
            <pre class="example replace">
{
    "accountEnabled": true,
    "displayName": "Adele Vance",
    "mailNickname": "AdeleV",
    "userPrincipalName": "AdeleV@woodgrove.onmicrosoft.com",
    "passwordProfile": {
        "forceChangePasswordNextSignIn": true,
        "password": "xWwvJ]6NMw+bWH-d"
    }
}</pre>

            <!-- PowerShell method-->
            <div class="function-powershell">
                <code><span class="method">New-MgBetaUser</span> <span class="param">-BodyParameter</span> $params</code><br>&nbsp;<br><br>
            </div>

        </div> <!--End of example-->


        <h5 class="graph-header graph-header-space">1.1 Copy the user ID</h5>
        From the response, copy the value of the <b>id</b>. For example:

        <!-- HTTP response-->
        <div class="function-http">
            <pre>
{
    "@@odata.context": "https://graph.microsoft.com/v1.0/$metadata#users/$entity",
    "id": "<span class="highlight">11111111-0000-0000-0000-000000000000</span>",
    ...
}        
        </pre>
        </div>

        <!-- PowerShell response-->
        <div class="function-powershell">
            <table class="table">
                <thead>
                    <tr>
                        <td scope="col">DisplayName</td>
                        <td scope="col"><span class="highlight">Id</span></td>
                        <td scope="col">UserPrincipalName</td>
                    </tr>
                </thead>
                <tr scope="row">
                    <td>Adele Vance</td>
                    <td>11111111-0000-0000-0000-000000000000</td>
                    <td>AdeleV@woodgrove.onmicrosoft.com</td>
                </tr>
            </table>
        </div>

        <h4 class="graph-header graph-header-space">2. Assign admin role</h4>
        <p>
            After the new user is created, <a
                href="https://learn.microsoft.com/graph/api/rbacapplication-post-roleassignments" target="_blank"
                class="link-dark link-offset-2">create a (unified) role assignment</a>.
            In the following Graph, replace the:

        <ul>
            <li><b>{user-id}</b> with the user <b>id</b> from the previous step.</li>
            <li><b>{role-id}</b> with one of the <a
                    href="https://learn.microsoft.com/entra/identity/role-based-access-control/permissions-reference"
                    target="_blank" class="link-dark link-offset-2">Microsoft Entra built-in roles</a>.</li>
        </ul>
        </p>

        <!-- HTTP method-->
        <div class="function-http">
            <code><span class="method">POST</span> https://graph.microsoft.com/v1.0/roleManagement/directory/roleAssignments</code>
        </div>

        <!-- PowerShell method-->
        <div class="function-powershell">
            <code><span class="method">Connect-MgGraph</span> <span class="param">-Scopes</span> "RoleManagement.ReadWrite.Directory"</code>
        </div>

        <a type="button" class="link-opacity-75 copyToClipboard" href="#"><i class="bi bi-copy"></i></a>
        <pre class="replace">
{
    "principalId": "<span class="highlight">{user-id}</span>",
    "roleDefinitionId": "<span class="highlight">{role-id}</span>",
    "directoryScopeId": "/"
}

</pre>

        <!-- PowerShell method-->
        <div class="function-powershell">
            <code><span class="method">New-MgRoleManagementDirectoryRoleAssignment</span> <span class="param">-BodyParameter</span> $params</code><br>&nbsp;<br><br>
        </div>

        <!-- Create assing role example-->
        <a class="btn btn-success btn-sm" data-bs-toggle="collapse"
            href="#collapseAssingRole" role="button" aria-expanded="false" aria-controls="collapseAssingRole">
            Show example
        </a><br>
        <div class="collapse example" id="collapseAssingRole">
            The following example assigns the <b>Global Administrator</b> role to Adele Vance
            <br>

            <!-- HTTP method-->
            <div class="function-http">
                <code><span class="method">POST</span> https://graph.microsoft.com/v1.0/roleManagement/directory/roleAssignments</code>
            </div>



            <a type="button" class="link-opacity-75 copyToClipboard" href="#"><i class="bi bi-copy"></i></a>
            <pre class="example replace">
{
    "principalId": "11111111-0000-0000-0000-000000000000",
    "roleDefinitionId": "62e90394-69f5-4237-9190-012177145e10",
    "directoryScopeId": "/"
} </pre><br>

            <!-- PowerShell method-->
            <div class="function-powershell">
                <code><span class="method">New-MgRoleManagementDirectoryRoleAssignment</span> <span class="param">-BodyParameter</span> $params</code><br>
            </div>

        </div><!--End of example-->
    </div>

    <div class="tab-pane" id="graphPowerShell" role="tabpanel" aria-labelledby="graphPowerShell-tab" tabindex="0">
        Loading...
    </div>


    <div class="tab-pane" id="entraGraphPowerShell" role="tabpanel" aria-labelledby="entraGraphPowerShell-tab"
        tabindex="0">
        Comming soon
    </div>
</div>
